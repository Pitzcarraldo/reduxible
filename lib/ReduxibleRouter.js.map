{"version":3,"sources":["../src/ReduxibleRouter.js"],"names":[],"mappings":"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","file":"ReduxibleRouter.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport ReactDOMServer from 'react-dom/server';\nimport Router from 'react-router/lib/Router';\nimport RouterContext from 'react-router/lib/RouterContext';\nimport match from 'react-router/lib/match';\nimport Provider from 'react-redux/lib/components/Provider';\nimport { syncHistoryWithStore } from 'react-router-redux';\n\nexport default class ReduxibleRouter {\n  constructor(options, history, store) {\n    this.routes = options.routes;\n    this.container = options.container;\n    this.errorContainer = options.errorContainer;\n    this.devTools = options.devTools;\n    this.extras = options.extras;\n    this.history = syncHistoryWithStore(history, store);\n    this.store = store;\n  }\n\n  static renderComponent({ container, component = <div></div>, error, store = {}, extras = {} }) {\n    const Html = container;\n    return `<!doctype html>\n      ${ReactDOMServer.renderToString(\n      <Html component={component} error={error} store={store} { ...extras } />\n    )}`;\n  }\n\n  provide(children) {\n    return (\n      <Provider store={this.store} key=\"provider\">\n        {children}\n      </Provider>\n    );\n  }\n\n  route(routes, history, location) {\n    return new Promise((resolve, reject) => {\n      match({ routes, history, location }, (error, redirectLocation, renderProps) => {\n        if (error) {\n          return reject(error);\n        }\n\n        if (!redirectLocation && !renderProps) {\n          return reject(\n            new Error(\n              'Failed to route. There is no matching path. Please check your routes configuration.'\n            )\n          );\n        }\n\n        if (redirectLocation) {\n          return resolve([redirectLocation]);\n        }\n\n        return resolve([null, renderProps]);\n      });\n    });\n  }\n\n  async renderServer(location) {\n    try {\n      const [redirectLocation, renderProps] = await this.route(this.routes, this.history, location);\n      const { container, store, extras } = this;\n      const component = this.provide(<RouterContext {...renderProps} />);\n      return {\n        redirectLocation,\n        rendered: ReduxibleRouter.renderComponent({ container, component, store, extras })\n      };\n    } catch (error) {\n      const { errorContainer: container, extras } = this;\n      if (container) {\n        error.component = ReduxibleRouter.renderComponent({ container, error, extras });\n      }\n      throw error;\n    }\n  }\n\n  getLocation() {\n    const { pathname, search, hash } = window.location;\n    return `${pathname}${search}${hash}`;\n  }\n\n  getRouter(renderProps, history, routes) {\n    return <Router history={history} routes={routes} {...renderProps} />;\n  }\n\n  getRouterWithDevTools(renderProps) {\n    const DevTools = this.devTools;\n    return (\n      <div>\n        {this.getRouter(renderProps)} <DevTools />\n      </div>\n    );\n  }\n\n  async renderClient(container, callback) {\n    let router;\n    try {\n      const [, renderProps] = await this.route(this.routes, this.history, this.getLocation());\n      router = this.provide(this.getRouter(renderProps));\n    } catch (error) {\n      console.error(error);\n      router = this.provide(this.getRouter({}, this.history, this.routes));\n    }\n    ReactDOM.render(router, container, callback);\n  }\n\n  async renderClientWithDevTools(container, callback) {\n    let router;\n    try {\n      window.React = React;\n      const [, renderProps] = await this.route(this.routes, this.history, this.getLocation());\n      router = this.provide(this.getRouterWithDevTools(renderProps));\n    } catch (error) {\n      console.error(error);\n      router = this.provide(this.getRouterWithDevTools({}, this.history, this.routes));\n    }\n    ReactDOM.render(router, container, callback);\n  }\n}\n"]}
{"version":3,"sources":["../src/ReduxibleRouter.js"],"names":[],"mappings":"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","file":"ReduxibleRouter.js","sourcesContent":["import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport ReactDOMServer from 'react-dom/server';\r\nimport Router from 'react-router/lib/Router';\r\nimport RouterContext from 'react-router/lib/RouterContext';\r\nimport match from 'react-router/lib/match';\r\nimport Provider from 'react-redux/lib/components/Provider';\r\nimport { syncHistoryWithStore } from 'react-router-redux';\r\nimport { preInitialize, removeRequest } from './contextService';\r\nimport warning from './warning';\r\n\r\n\r\nexport default class ReduxibleRouter {\r\n  constructor(options) {\r\n    const {\r\n      routes,\r\n      container,\r\n      errorContainer,\r\n      extras,\r\n      history,\r\n      store\r\n    } = options;\r\n\r\n    this.routes = routes;\r\n    this.container = container;\r\n    this.errorContainer = errorContainer;\r\n    this.extras = extras;\r\n    this.history = syncHistoryWithStore(history, store);\r\n    this.store = store;\r\n  }\r\n\r\n  async renderServer(location) {\r\n    try {\r\n      const [redirectLocation, renderProps] = await this.route(this.routes, this.history, location);\r\n      const { container, store, extras } = this;\r\n      if (renderProps) {\r\n        const { keys, actions } = this.extractKeysAndActions(renderProps.components);\r\n        await preInitialize(store, keys, actions);\r\n      }\r\n      await store.dispatch(removeRequest());\r\n      const component = this.provide(<RouterContext {...renderProps} />);\r\n      return {\r\n        redirectLocation,\r\n        rendered: ReduxibleRouter.renderComponent({ container, component, store, extras })\r\n      };\r\n    } catch (error) {\r\n      const { errorContainer: container, extras } = this;\r\n      if (container) {\r\n        error.component = ReduxibleRouter.renderComponent({ container, error, extras });\r\n      }\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async renderClient(container, callback) {\r\n    let router;\r\n    try {\r\n      const [, renderProps] = await this.route(this.routes, this.history, this.getLocation());\r\n      router = this.provide(this.getRouter(renderProps));\r\n    } catch (error) {\r\n      warning(error);\r\n      router = this.provide(this.getRouter({}, this.routes, this.history));\r\n    }\r\n    ReactDOM.render(router, container, callback);\r\n  }\r\n\r\n  route(routes, history, location) {\r\n    return new Promise((resolve, reject) => {\r\n      match({ routes, history, location }, (error, redirectLocation, renderProps) => {\r\n        if (error) {\r\n          return reject(error);\r\n        }\r\n\r\n        if (!redirectLocation && !renderProps) {\r\n          return reject(\r\n            new Error(\r\n              'Failed to route. There is no matching path. Please check your routes configuration.'\r\n            )\r\n          );\r\n        }\r\n\r\n        if (redirectLocation) {\r\n          return resolve([redirectLocation]);\r\n        }\r\n\r\n        return resolve([null, renderProps]);\r\n      });\r\n    });\r\n  }\r\n\r\n  extractKeysAndActions(components) {\r\n    return components.reduce((prev, { key, initialActions }) => {\r\n      if (key) prev.keys.push(key); // eslint-disable-line\r\n      if (initialActions) prev.actions.push(...initialActions); // eslint-disable-line\r\n      return prev;\r\n    }, { keys: [], actions: [] });\r\n  }\r\n\r\n  provide(children) {\r\n    return (\r\n      <Provider store={this.store} key=\"provider\">\r\n        {children}\r\n      </Provider>\r\n    );\r\n  }\r\n\r\n  static renderComponent({ container, component = <div></div>, error, store = {}, extras = {} }) {\r\n    const Html = container;\r\n    return `<!doctype html>\r\n      ${ReactDOMServer.renderToString(\r\n      <Html component={component} error={error} store={store} { ...extras } />\r\n    )}`;\r\n  }\r\n\r\n  getLocation() {\r\n    const { pathname, search, hash } = window.location;\r\n    return `${pathname}${search}${hash}`;\r\n  }\r\n\r\n  getRouter(renderProps, routes, history) {\r\n    return <Router {...renderProps} routes={routes} history={history} />;\r\n  }\r\n\r\n}\r\n"]}
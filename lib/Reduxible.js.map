{"version":3,"sources":["../src/Reduxible.js"],"names":[],"mappings":"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","file":"Reduxible.js","sourcesContent":["import ReduxibleConfig from './ReduxibleConfig';\nimport StoreFactory from './StoreFactory';\nimport RouterFactory from './RouterFactory';\nimport createBrowserHistory from 'history/lib/createBrowserHistory';\nimport createHashHistory from 'history/lib/createHashHistory';\nimport createMemoryHistory from 'history/lib/createMemoryHistory';\nimport contextMiddleware from './contextMiddlerware';\nimport warning from './warning';\n\nexport default class Reduxible {\n  constructor(options = {}) {\n    this.config = new ReduxibleConfig(options.config || options);\n    this.routerFactory = new RouterFactory(options);\n    this.storeFactory = new StoreFactory({ ...options, useDevTools: this.config.useDevTools() });\n    this.initialActions = options.initialActions || [];\n  }\n\n  server() {\n    if (!this.config.isServer()) {\n      throw new Error('A server() only can be called in server environment. Please check your config arguments.');\n    }\n    return async(req, res, next) => {\n      try {\n        if (!this.config.isUniversal()) {\n          return res.send(this.routerFactory.renderContainer());\n        }\n\n        const history = createMemoryHistory();\n        const store = this.storeFactory.createStore({},\n          [ contextMiddleware({ config: this.config, history, req, res, next }) ]);\n\n        await this.preInitialize(store);\n\n        const router = this.routerFactory.createRouter(history, store);\n        const url = req.originalUrl || req.url || '/';\n        const { redirectLocation, rendered } = await router.renderServer(url, store);\n\n        if (redirectLocation) {\n          return res.redirect(redirectLocation.pathname);\n        }\n\n        return res.send(rendered);\n      } catch (error) {\n\n        warning(error.stack);\n\n        if (error.component) {\n          res.status(500);\n          return res.send(error.component);\n        }\n\n        return next(error);\n      }\n    };\n  }\n\n  async preInitialize(store) {\n    try {\n      const willDispatch = this.initialActions.map(action => Promise.resolve(store.dispatch(action)));\n      return await Promise.all(willDispatch);\n    } catch (error) {\n      warning('Failed to PreInitialize. Render with initialStates.');\n      warning(error.stack);\n    }\n  }\n\n  client(initialState = {}, container, callback) {\n    if (!this.config.isClient()) {\n      throw new Error('A client() only can be called in browser. Please check your config arguments.');\n    }\n\n    if (!container) {\n      throw new Error('A container element is empty.');\n    }\n\n    let history;\n    try {\n      history = this.config.useHashHistory() ? createHashHistory() : createBrowserHistory();\n    } catch (error) {\n      warning('Failed to initialize browser history. Use memory history.');\n      history = createMemoryHistory();\n    }\n    const store = this.storeFactory.createStore(initialState, [ contextMiddleware({ config: this.config, history }) ]);\n    const router = this.routerFactory.createRouter(history, store);\n\n    router.renderClient(container, callback);\n\n    if (this.config.useDevTools()) {\n      router.renderClientWithDevTools(container, callback);\n    }\n  }\n}\n"]}